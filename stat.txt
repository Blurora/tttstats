import React, { useState, useEffect } from 'react';
import './TicTacToeStats.css';

const TicTacToeStats = ({ games = [] }) => {
  const [filter, setFilter] = useState('all');
  const [stats, setStats] = useState({
    xWins: 0,
    oWins: 0,
    ties: 0
  });

  // Sample data matching your image
  const defaultGames = [
    {
      id: 1,
      winner: 'tie',
      playerX: 'Player X',
      playerO: 'Computer',
      timestamp: '2026-01-14T11:55:00',
      mode: 'PvC',
      difficulty: 'hard',
      resultText: "It's a tie!"
    },
    {
      id: 2,
      winner: 'X',
      playerX: 'Player X',
      playerO: 'Computer',
      timestamp: '2026-01-14T11:55:00',
      mode: 'PvC',
      difficulty: 'medium',
      resultText: "Player X (X) wins!"
    },
    {
      id: 3,
      winner: 'X',
      playerX: 'Player X',
      playerO: 'Player O',
      timestamp: '2026-01-14T11:54:00',
      mode: 'PvP',
      difficulty: null,
      resultText: "Player X (X) wins!"
    }
  ];

  // Use provided games or default sample
  const gameHistory = games.length > 0 ? games : defaultGames;

  // Calculate statistics
  useEffect(() => {
    const xWins = gameHistory.filter(game => game.winner === 'X').length;
    const oWins = gameHistory.filter(game => game.winner === 'O').length;
    const ties = gameHistory.filter(game => game.winner === 'tie').length;
    
    setStats({ xWins, oWins, ties });
  }, [gameHistory]);

  // Filter games based on selected filter
  const filteredGames = gameHistory.filter(game => {
    if (filter === 'all') return true;
    if (filter === 'wins') return game.winner !== 'tie';
    if (filter === 'ties') return game.winner === 'tie';
    return true;
  });

  // Format timestamp
  const formatTimestamp = (timestamp) => {
    const date = new Date(timestamp);
    const time = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    const dateStr = date.toISOString().split('T')[0];
    return { time, date: dateStr };
  };

  // Get mode display text
  const getModeText = (game) => {
    return game.difficulty ? `${game.mode} (${game.difficulty})` : game.mode;
  };

  // Get emoji for winner
  const getWinnerEmoji = (winner) => {
    switch(winner) {
      case 'X': return 'âŒ';
      case 'O': return 'â­•';
      case 'tie': return 'ðŸ¤';
      default: return '';
    }
  };

  // Clear history function
  const clearHistory = () => {
    if (window.confirm('Are you sure you want to clear all game history?')) {
      // Implement your clear logic here
      console.log('History cleared');
    }
  };

  return (
    <div className="tic-tac-toe-stats">
      <h1>Game History</h1>
      
      <div className="filter-buttons">
        <button 
          className={`filter-btn ${filter === 'all' ? 'active' : ''}`}
          onClick={() => setFilter('all')}
        >
          All
        </button>
        <button 
          className={`filter-btn ${filter === 'wins' ? 'active' : ''}`}
          onClick={() => setFilter('wins')}
        >
          Wins
        </button>
        <button 
          className={`filter-btn ${filter === 'ties' ? 'active' : ''}`}
          onClick={() => setFilter('ties')}
        >
          Ties
        </button>
      </div>
      
      <div className="stats-summary">
        <div className="stat-item x-wins">
          <div className="stat-count">{stats.xWins}</div>
          <div className="stat-label">X Wins</div>
        </div>
        
        <div className="stat-item ties">
          <div className="stat-count">{stats.ties}</div>
          <div className="stat-label">Ties</div>
        </div>
        
        <div className="stat-item o-wins">
          <div className="stat-count">{stats.oWins}</div>
          <div className="stat-label">O Wins</div>
        </div>
      </div>
      
      <div className="history-list">
        {filteredGames.length === 0 ? (
          <div className="empty-state">
            <p>No games found</p>
          </div>
        ) : (
          filteredGames.map((game) => {
            const { time, date } = formatTimestamp(game.timestamp);
            const modeText = getModeText(game);
            const winnerEmoji = getWinnerEmoji(game.winner);
            
            return (
              <div 
                key={game.id} 
                className={`history-item ${game.winner === 'tie' ? 'tie' : 'win'}`}
              >
                <div className="game-result">
                  <span className="winner-emoji">{winnerEmoji}</span>
                  {game.resultText}
                </div>
                
                <div className="game-meta">
                  <div className="meta-row">
                    <span className="time">{time}</span>
                    <span className="mode">{modeText}</span>
                  </div>
                  <div className="date">{date}</div>
                </div>
              </div>
            );
          })
        )}
      </div>
      
      <button className="clear-history-btn" onClick={clearHistory}>
        Clear History
      </button>
    </div>
  );
};

export default TicTacToeStats;
